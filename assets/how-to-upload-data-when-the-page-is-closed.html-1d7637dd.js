import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,a as t,b as p,f as e}from"./app-af427ef1.js";const o={},c=p("p",null,"ä»¥â€œå‰ç«¯ç›‘æ§ä¸Šä¼ æ•°æ®â€ä¸šåŠ¡åœºæ™¯ï¼Œé‡ç‚¹åœ¨é¡µé¢å…³é—­æ—¶ï¼Œå°†ç›‘æ§æ•°æ®ä¸Šä¼ åˆ°æœåŠ¡ç«¯çš„è§£å†³æ–¹æ¡ˆã€‚",-1),i=e(`<p>ğŸŒ°ï¼šè¡¨å•æäº¤åï¼Œé¡µé¢è·³è½¬æ—¶éœ€è¦ä¸ŠæŠ¥æ•°æ®ï¼Œä¸»è¦æ¶‰åŠåˆ°4ç§æ–¹æ¡ˆï¼š</p><ul><li>åŒæ­¥XMLHttpRequest</li><li>img.src</li><li>navigator.sendBeason</li><li>fetch keepalive</li></ul><h2 id="_1-åŒæ­¥xmlhttprequest" tabindex="-1"><a class="header-anchor" href="#_1-åŒæ­¥xmlhttprequest" aria-hidden="true">#</a> 1. åŒæ­¥XMLHttpRequest</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ç¬¬ä¸‰ä¸ªå‚æ•°falseï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚æ˜¯åŒæ­¥</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://api.coder-new.cn/test&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//å‘é€æˆåŠŸåï¼Œé¡µé¢å·²é”€æ¯ï¼Œæ‰€ä»¥è¿™é‡Œæ‰§è¡Œä¸äº†</span>
<span class="token punctuation">}</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºä»€ä¹ˆåŒæ­¥XMLHttpRequestå¯ä»¥åœ¨é¡µé¢å…³é—­æ—¶ä¸Šä¼ æ•°æ®ï¼Ÿ</p><p>åŒæ­¥è¯·æ±‚é˜»æ­¢ä»£ç çš„æ‰§è¡Œï¼Œè¿™ä¼šå¯¼è‡´å±å¹•ä¸Šå‡ºç°â€œå†»ç»“â€å’Œæ— å“åº”çš„ç”¨æˆ·ä½“éªŒã€‚åœ¨æ–°ç‰ˆçš„Chromeï¼ˆç‰ˆæœ¬å·å¤§äº80ï¼‰å®˜æ–¹çš„å…¬å‘Šå·²ç»ä¸æ”¯æŒã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>ç”¨æˆ·ä½“éªŒå·®ï¼Œä¼šé˜»å¡é¡µé¢åˆ‡æ¢</li><li>åªæœ‰æ—§ç‰ˆçš„æµè§ˆå™¨æ”¯æŒ</li><li>æ— æ³•è¯»å–responseçš„è¿”å›å€¼</li></ul><h2 id="_2-img-src" tabindex="-1"><a class="header-anchor" href="#_2-img-src" aria-hidden="true">#</a> 2. img.src</h2><p>åˆ›å»ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è®¾ç½®srcï¼Œéƒ¨åˆ†çš„æµè§ˆå™¨ï¼Œä¼šå»¶è¿Ÿå¸è½½å½“å‰é¡µé¢ï¼Œä¼˜å…ˆåŠ è½½å›¾åƒã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://api.coder-new.cn/test?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼ºç‚¹ï¼š</p><ul><li>æ•°æ®ä¼ è¾“ä¸å¯é ï¼Œæœ‰å¯èƒ½æµè§ˆå™¨å¸è½½å½“å‰é¡µé¢ï¼Œç›´æ¥æ€æ‰å›¾åƒè¯·æ±‚ã€‚</li><li>åªèƒ½å‘èµ·Getè¯·æ±‚ã€‚</li><li>æ•°æ®å¤§å°è¯·æ±‚é™åˆ¶ã€‚</li></ul><h2 id="_3-navigator-sendbeacon" tabindex="-1"><a class="header-anchor" href="#_3-navigator-sendbeacon" aria-hidden="true">#</a> 3. navigator.sendBeacon</h2><p>é€šè¿‡HTTP POSTè¯·æ±‚ï¼Œå°†å°‘é‡æ•°æ®ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼ï¼Œå‘é€åˆ°æœåŠ¡å™¨ã€‚</p><p>å‘é€æ•°æ®ï¼šæµè§ˆå™¨è‡ªåŠ¨åˆ¤æ–­åˆé€‚çš„æ—¶æœºè¿›è¡Œå‘é€ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">reportEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&quot;https://api.coder-new.cn/test&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">time</span><span class="token operator">:</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;visibilitychange&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>visiblityState <span class="token operator">===</span> <span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">reportEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ä¼šäº§ç”Ÿé˜»å¡ï¼Œå½±å“å½“å‰é¡µé¢çš„å¸è½½ã€‚ä¸å½±å“ä¸‹ä¸ªæ–°é¡µé¢çš„åŠ è½½ï¼Œä¸å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚å¦å¤–ï¼Œæ•°æ®ä¼ è¾“å¯é ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>åªèƒ½å‘èµ·POSTè¯·æ±‚</li><li>æ— æ³•è‡ªå®šä¹‰è¯·æ±‚å¤´å‚æ•°</li><li>æ•°æ®å¤§å°æœ‰é™åˆ¶ï¼ˆChromeé™åˆ¶å¤§å°ä¸º64KBï¼‰</li><li>åªèƒ½åœ¨windowäº‹ä»¶visibilitychangeå’Œbeforeunloadä¸­ä½¿ç”¨ï¼Œå…¶å®ƒäº‹ä»¶ä¸­å›è°ƒï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚</li></ul><h2 id="_4-fetch-keepalive" tabindex="-1"><a class="header-anchor" href="#_4-fetch-keepalive" aria-hidden="true">#</a> 4. fetch keepalive</h2><div class="hint-container note"><p class="hint-container-title">MDN web docsçš„æè¿°å¦‚ä¸‹</p><p>The keepalive option can be used to allow the request to outlive the page. Fetch with the keepalive flag is a replacement for the <code>Navigator.sendBeacon()</code> API.</p></div><p>æ ‡è®°<code>keepalive</code>çš„fetchè¯·æ±‚å…è®¸åœ¨é¡µé¢å¸è½½åæ‰§è¡Œï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&quot;https://api.coder-cn.cn/test&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,24);function l(u,r){return s(),a("div",null,[c,t(" more "),i])}const v=n(o,[["render",l],["__file","how-to-upload-data-when-the-page-is-closed.html.vue"]]);export{v as default};
